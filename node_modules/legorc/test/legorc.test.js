var fs = require('fs');
var path = require('path');
var should = require('should');
var legorc = require('..');

describe('legorc', function() {

  legorc.legorcfile = path.join(__dirname, './tmp/legorc');

  it('get nothing', function() {
    legorc.get().should.eql({});
  });

  it('get default values', function() {
    legorc.get('install.path').should.equal('lego_modules');
    legorc.get('registry').should.equal('http://lego.oa.com');
  });

  it("write data", function() {
    legorc.write({
      user: {
        username: "lego3"
      }
    });
    legorc.get('user.username').should.equal('lego3');
  });

  it('set user.username = lego', function() {
    legorc.set('user.username', 'lego');
  });

  it('get user.username', function() {
    legorc.get('user.username').should.equal('lego');
  });

  it('set auth = lego', function() {
    legorc.set('auth', 'lego');
  });

  it('get auth', function() {
    legorc.get('auth').should.equal('lego');
  });

  it('get via config', function() {
    legorc.config('user.username').should.equal('lego');
  });

  it('set via config', function() {
    legorc.config('user.username', 'legojs');
    legorc.get('user.username').should.equal('legojs');
  });

  it('get localrc', function() {
    var localrc = path.join(process.cwd(), '.legorc');
    var content = "[user]\nusername = legojs2";

    if (fs.existsSync(localrc)) {
      console.warn(".legorc should not be hered")
      return;
    }

    fs.writeFileSync(localrc, content);
    legorc.get('user.username').should.equal('legojs2');
    fs.unlinkSync(localrc);
  });

  it('set section:title.key', function() {
    legorc.set('section:title.key', 'value');
    legorc.get('section:title.key').should.equal('value');
    legorc.get('section.title.key').should.equal('value');
  });

  it('set section.title.key', function() {
    legorc.set('section.title.key', 'value2');
    legorc.get('section:title.key').should.equal('value2');
    legorc.get('section.title.key').should.equal('value2');
  });

  after(function() {
    fs.unlinkSync(legorc.legorcfile);
  });
});
